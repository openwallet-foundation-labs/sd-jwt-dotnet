# Release Please Workflow
# This workflow automates semantic versioning and changelog generation based on
# Conventional Commits merged into the main branch.
#
# How it works:
#  1. On every push to main, Release Please analyzes commit messages.
#  2. It creates (or updates) a Release PR containing:
#     - Updated CHANGELOG.md with categorized changes.
#     - The next semantic version (determined by commit types).
#  3. When the Release PR is merged by a maintainer, Release Please:
#     - Creates a DRAFT GitHub Release with the new tag (e.g., v1.2.0).
#     - The draft allows maintainers to review/edit release notes before publishing.
#  4. When a maintainer manually publishes the draft release:
#     - The publish-nuget.yml workflow triggers to build and publish to NuGet.

name: Draft Release PR (Release Please)

on:
  push:
    branches:
      - main

permissions:
  contents: write
  pull-requests: write

jobs:
  release-please:
    runs-on: ubuntu-latest
    outputs:
      release_created: ${{ steps.release.outputs.release_created }}
      tag_name: ${{ steps.release.outputs.tag_name }}

    steps:
      - name: Run Release Please
        id: release
        uses: googleapis/release-please-action@v4
        with:
          # Prefer a PAT so release/tag creation can trigger downstream workflows.
          token: ${{ secrets.RELEASE_PLEASE_TOKEN || secrets.GITHUB_TOKEN }}
          config-file: .github/release-please-config.json
          manifest-file: .release-please-manifest.json
